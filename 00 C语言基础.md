# 位操作

## 一、C 语言常见位操作符总结

| 操作符 | 名称   | 作用说明                                              | 示例                       |
| ------ | ------ | ----------------------------------------------------- | -------------------------- |
| `&`    | 位与   | 两位都为1时，结果为1                                  | `0b1100 & 0b1010 = 0b1000` |
| \|     | 位或   | 有一位为1，结果为1                                    | `0b1100 | 0b1010 = 0b1110` |
| `^`    | 位异或 | 相同为0，不同为1                                      | `0b1100 ^ 0b1010 = 0b0110` |
| `~`    | 位取反 | 0变1，1变0                                            | `~0b1100 = 0b0011...`      |
| `<<`   | 左移   | 将所有位向左移动，低位补0                             | `0b0001 << 2 = 0b0100`     |
| `>>`   | 右移   | 将所有位向右移动，高位补0（无符号）或符号位（有符号） | `0b1000 >> 2 = 0b0010`     |

------

## 二、嵌入式开发常用的位操作技巧（寄存器操作）

寄存器本质就是一个 `uint32_t` 类型的变量，位操作就是直接控制它的某一位或几位。

### 1. **置位（Set）—— 让某些位变成 1**

```c
REG |= (1 << N);       // 将第 N 位设置为 1
```

> 例如：`GPIOA->ODR |= (1 << 5);` 点亮 PA5（假设接了 LED）

------

### 2. **清位（Clear）—— 让某些位变成 0**

```c
REG &= ~(1 << N);      // 将第 N 位清零
```

> 例如：`GPIOA->ODR &= ~(1 << 5);` 熄灭 PA5

------

### 3. **翻转某一位（Toggle）**

```c
REG ^= (1 << N);       // 将第 N 位取反
```

> 例如：`GPIOA->ODR ^= (1 << 5);` 翻转 LED 状态

------

### 4. **读取某一位（判断为0还是1）**

```c
value = (REG >> N) & 0x01;
```

或者直接判断：

```c
if (REG & (1 << N)) { ... }   // 如果第 N 位为 1
```

------

### 5. **修改某几位的值（先清再设）**

```c
REG = (REG & ~MASK) | (NEW_VALUE << SHIFT);
```

例如，设置寄存器中第4~6位为 0b101：

```c
#define MASK  (0x7 << 4)       // 0b111000
REG = (REG & ~MASK) | (0x5 << 4);
```

------

### 6. **STM32 HAL 宏操作技巧**

STM32 HAL 通常也会提供一些封装好的宏，比如：

```c
__HAL_RCC_GPIOA_CLK_ENABLE();       // 开启 GPIOA 时钟
__HAL_GPIO_EXTI_CLEAR_IT(GPIO_PIN_0); // 清除 EXTI 中断志
```

## ✅ 三、推荐封装技巧（更易读）

有些人会封装成更直观的宏，例如：

```c
#define BIT_SET(REG, BIT)     ((REG) |= (1 << (BIT)))
#define BIT_CLEAR(REG, BIT)   ((REG) &= ~(1 << (BIT)))
#define BIT_TOGGLE(REG, BIT)  ((REG) ^= (1 << (BIT)))
#define BIT_READ(REG, BIT)    (((REG) >> (BIT)) & 0x1)
```

用法清晰易懂：

```c
BIT_SET(GPIOA->ODR, 5);       // 设置 PA5 为高
```

------

