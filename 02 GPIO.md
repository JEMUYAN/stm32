# 前言：片上外设的学习

- 了解基本的硬件原理，掌握操作时注意的特点
- 关注运行逻辑
- 掌握API接口
- 掌握重要寄存器

# GPIO简介

电平兼容性：绝大部分支持5V，具体查找数据手册（不是中文参考手册）

**功能模式：**

1. 输入浮空：
2. 如果 IO 引脚没有连接其他的设备，那么检测其输入电平是不确定的。

2. 输入上拉

3. 输入下拉：输出被禁止

4. 模拟功能：其他外设可以使用该通道输入输出，比如ADC

5. **开漏输出**
   - 可以读取该时刻引脚状态（输入数据寄存器）
   - F1要外接上拉电阻才能输出高阻态
   - IIC常用

6. **推挽输出**
   - 可读状态
   - 可做电流驱动

7. 开漏式复用功能&推挽式复用功能：可读状态；外设控制

# 寄存器

## 概况

STM32G1每组GPIO口有7个32位寄存器（每组控制16个引脚），包括：

- 2 个 32 位端口配置寄存器（CRL 和 CRH）
- 2 个 32 位端口数据寄存器（IDR 和 ODR）
- 1 个 32 位端口置位/复位寄存器 (BSRR)
- 1 个 32 位端口锁定寄存器 (LCKR) 

## 操作ODR和BSRR控制GPIO输出

ODR：只能以字（16位）的形式操作，所以要先读再写

BSRR：操作逻辑看手册，重点在于

- 只写
- 可位写
- 操作不会被中断打断

# HAL库驱动

## 驱动

GPIO_InitTypeDef：

```c
typedef struct
{
 uint32_t Pin; /* 引脚号 */
 uint32_t Mode; /* 模式设置 */
 uint32_t Pull; /* 上拉下拉设置 */
 uint32_t Speed; /* 速度设置 */
} GPIO_InitTypeDef;
```

- mode将外部中断&事件整合进去了

```
HAL_GPIO_WritePin();
HAL_GPIO_ReadPin();
HAL_GPIO_TogglePin();
```

## 输出&输入配置

1. 使能时钟
2. 设置mode
3. 控制高低电平/读取电平























