# NVIC

嵌套向量中断控制器，是M3内核的器件

## 寄存器

1. ISER：中断使能寄存器组
2. ICER：中断除能寄存器组，存在的意义是**M3内核中对寄存器写1有效写0无效**
3. ISPR&ICPR：挂起和解挂，用于中断的切换
4. IABR：中断激活标志位寄存器组，只读，了解目前正在执行的中断
5. IP[240]：中断优先级控制，由241个8bit寄存器组成，每一个对应向量表中的中断优先级，**且只有高四位有效**

## 驱动

```
HAL_NVIC_SetPriorityGrouping();	//设置分组
HAL_NVIC_SetPriority();			//设置优先级
HAL_NVIC_EnableIRQ();			//使能中断
HAL_NVIC_DisableIRQ();			//除能中断
```

# EXTI

## 概况

外部中断和事件控制器，它是由 20 个产生事件/中断请求的边沿检测器组成。每一条输入线都可以独立地配置输入类型（脉冲或挂起）和对应的触发事件（上升沿或下降沿或者双边沿都触发）。每个输入线都可以独立地被屏蔽。挂起寄存器保持着状态线的中断请求。

![image-20250412192149393](C:\Users\17721\AppData\Roaming\Typora\typora-user-images\image-20250412192149393.png)

输入线是信息输入端，一般是电平变化信号

中断线：

1. 通过 `1` 检测电路的判断，决定输入的信息是否为目标信息
2. `2` 受 `1` 和软件中断的控制：这一步是中断源的关键
3. 在 `4 ` 中通过分支将信息传给**EXTI_PR**(请求挂起寄存器)，**对于事件也有相应的SR来发挥类似作用**
4. 在 `3` 进行与判断

事件线：在 `4` 后方有不同，脉冲信号可以给其他外宿舍电路使用，比如定时器和数模转换器，**作为触发信号**

输入线：

- 0~15：对应外部IO口的输入中断
  - Pin号对应输入线
  - 映射关系有对应的寄存器
- 16~19：其他

## HAL库驱动

### 外部中断配置步骤

主要是NVIC和EXTI的配置，以及需要使用的IO口的配置

1. 使能对应的IO口时钟，配置IO口
2. 配置中断优先级并使能（NVIC）
3. 编写中断服务函数：接口在 `startup_stm32f103xe.s` 中已经编写

PS：GPIO的外部中断有通用的入口函数；清除中断标志位的操作很多时候已经帮我们编写好了（对 `EXTI_PR` 进行操作 ）

4. 编写回调函数：回调函数是公用的，由引脚分配易知只要判断引脚号即可





















